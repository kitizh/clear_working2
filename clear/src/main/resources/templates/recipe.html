<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Recipes</title>
    <link rel="stylesheet" th:href="@{/css/menu.css}">
    <style>
        .recipe-table {
            display: none;
            width: 100%;
            border-collapse: collapse;
            background-color: #FFF;
            margin-top: 10px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease-in-out;
        }

        .recipe-table th, .recipe-table td {
            border: 2px solid #E8C8B8;
            padding: 10px;
            text-align: center;
        }

        .recipe-table th {
            background-color: #F7E1D7;
            color: #241918;
        }

        .recipe-table td {
            color: #241918;
        }

        .dish-item {
            cursor: pointer;
            font-size: 20px;
            font-weight: bold;
            color: #FFF;
            padding: 12px;
            background-color: #996a5f;
            border-radius: 5px;
            transition: background-color 0.3s;
            text-align: center;
            display: block;
            width: 50%;
            margin: 10px auto;
            text-decoration: none;
        }

        .dish-item:hover {
            background-color: #7a5246;
        }

        ul {
            list-style-type: none;
            padding: 0;
        }

        li {
            text-align: center;
            margin-bottom: 10px;
        }
    </style>
    <script>
        function showDishRecipes(dishId) {
            let currentTable = document.getElementById('recipe-' + dishId);

            // Если таблица уже открыта - скрываем её
            if (currentTable.style.display === 'table') {
                currentTable.style.display = 'none';
            } else {
                // Скрываем все другие таблицы
                document.querySelectorAll('.recipe-table').forEach(table => table.style.display = 'none');

                // Показываем таблицу рецептов для текущего блюда
                currentTable.style.display = 'table';
            }
        }

        function showTab(type) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.style.display = 'none');
            document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
            document.getElementById(type).style.display = 'block';
            document.querySelector(`.tab-button[data-type="${type}"]`).classList.add('active');
        }

        document.addEventListener('DOMContentLoaded', function () {
            const buttons = document.querySelectorAll('.tab-button');
            if (buttons.length > 0) {
                showTab(buttons[0].getAttribute('data-type'));
            }

            buttons.forEach(button => {
                button.addEventListener('click', () => showTab(button.getAttribute('data-type')));
            });
        });
    </script>
</head>
<body>

<div class="container">
    <a href="/" class="home-button">Main Page</a>

    <nav>
        <ul>
            <li><a href="/menu">Menu</a></li>
            <li><a href="/recipe" class="active">Recipes</a></li>
        </ul>
    </nav>

    <h1>Recipes</h1>

    <div class="tabs">
        <button class="tab-button" th:each="type : ${menuTypes}"
                th:text="${type.getTypeName()}"
                th:attr="data-type=${type.getTypeName()}">
        </button>
    </div>

    <!-- Список блюд -->
    <div th:each="type : ${menuTypes}" th:id="${type.getTypeName()}" class="tab-content" style="display: none;">
        <h2 th:text="${type.getTypeName()}"></h2>

        <ul>
            <li th:each="menu : ${menuItems.get(type.getTypeName())}">
                <a class="dish-item" th:text="${menu.dishName}" th:onclick="|showDishRecipes(${menu.menuId});|"></a>

                <!-- Таблица рецептов (скрыта по умолчанию) -->
                <table class="recipe-table" th:id="'recipe-' + ${menu.menuId}" style="display: none;">
                    <thead>
                    <tr>
                        <th>Ингредиент</th>
                        <th>Количество</th>
                        <th>Единица измерения</th>
                        <th></th>
                        <th></th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="recipe : ${recipes.get(menu.dishName)}">
                        <td th:text="${recipe.stock != null ? recipe.stock.item.itemName : 'Unknown'}"></td>
                        <td>
                            <input type="number" name="amount" th:value="${recipe.amount}" required>
                        </td>
                        <td>
                            <select name="unitId">
                                <option th:each="unit : ${units}"
                                        th:value="${unit.unitId}"
                                        th:text="${unit.unitName}"
                                        th:selected="${recipe.unit.unitId == unit.unitId}">
                                </option>
                            </select>
                        </td>
                        <td>
                            <form th:action="@{/recipe/update}" method="post">
                                <input type="hidden" name="recipeId" th:value="${recipe.recipeId}">
                                <input type="hidden" name="menuId" th:value="${recipe.menu.menuId}">
                                <input type="hidden" name="stockId" th:value="${recipe.stock != null ? recipe.stock.stockId : ''}">
                                <button type="submit" class="admin-btn edit">Save</button>
                            </form>
                        </td>
                        <td>
                            <form th:action="@{/recipe/delete}" method="post">
                                <input type="hidden" name="recipeId" th:value="${recipe.recipeId}">
                                <button type="submit" class="admin-btn delete">Delete</button>
                            </form>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </li>
        </ul>
    </div>

</div>

</body>
</html>
